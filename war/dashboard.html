<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>WebPaige :: Dashboard</title>
  
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="WebPaige" name="description">
  <meta content="Cengiz Ulusoy" name="author">
  
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <link href="css/bootstrap-responsive.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
  <link href="img/ico/favicon.ico" rel="shortcut icon">
  <link href="img/ico/apple-touch-icon-144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144">
  <link href="img/ico/apple-touch-icon-114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114">
  <link href="img/ico/apple-touch-icon-72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72">
  <link href="img/ico/apple-touch-icon-57-precomposed.png" rel="apple-touch-icon-precomposed">
  
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="js/jquery-1.7.2.min.js"></script><script src="js/bootstrap.js"></script>
  
  <script src="js/libs/ask.session.js" type="text/javascript"></script>
  <script src="js/libs/json2.js" type="text/javascript"></script>
  
  <script type="text/javascript">    
  
    $(document).ready(function() {
    
      //checkLogin();
      loadUserInfo();
      
    });
    
    var session = new ask.session(showLogin);
    session.getSession();

		/*
		function checkLogin() {
			if (!localStorage.getItem('loggedIn')) {
					document.location = "login.html";
			}
		}
		*/

    function showLogin() {
      document.location = 'login.html';
    }

    function loadUserInfo() {
      $.ajax({
        url: host + '/resources',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-SESSION_ID', session.getSession());
          return true;
        },
        contentType: 'application/json',
        xhrFields: {
          withCredentials: true
        },
        success: function(jsonData) {
          renderInfo(jsonData);
        },
        error: function() {
        }
      });
    }

    function renderInfo(user) {
      //console.log(user);
      localStorage.setItem('user', JSON.stringify(user));
     	$(".d_username").html(user.name);
      
      //console.log('Session ID: ', session.getSession());
      //console.log('Sense Session ID: ', localStorage.getItem('senseSessionId'));
      
      loadSenseSensors();
    }
    
    function loadSenseSensors()
    {
      $.ajax({
        url: 'http://api.sense-os.nl/sensors?per_page=1000',
        type: 'GET',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-SESSION_ID', localStorage.getItem('senseSessionId'));
          return true;
        },
        contentType: 'application/json',
        xhrFields: {
          withCredentials: false
        },
        success: function(jsonData, status, xhr) {
          var json = JSON.parse(xhr.responseText);
          var sensors = json["sensors"];
          
          $.each(sensors,
            function(i, item)
            {
              if(item.name == "Location")
              {
              	loadLocationData(item.id);
              	//console.log('Location Sensor ID:', item.id);
              }
              else if(item.name == "Activity")
              {	              	
              	loadActivityData(item.id);
              	//console.log('Activity Sensor ID:', item.id);
              }
            }
	        );
	        
        },
        error: function() {
        }
      });    
    }
    
    function loadLocationData(sensorID)
    {
      $.ajax({
        url: 'http://api.sense-os.nl/sensors/' + sensorID + '/data.json?last=1',
        type: 'GET',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-SESSION_ID', localStorage.getItem('senseSessionId'));
          return true;
        },
        contentType: 'application/json',
        xhrFields: {
          withCredentials: false
        },
        success: function(jsonData, status, xhr) {
          var json = JSON.parse(xhr.responseText);
          var data = json["data"];
          renderLocationData(data);
    			//console.log(data);   
        },
        error: function() {
        }
      });   
    }
    
    function renderLocationData(data){
    	var location = data.pop();
    	console.log('Location :', location);
    	
      //var location = JSON.stringify(location);
     	//$("#location").html(location.value);
     	  
    	console.log('Location :', location.value);	
    }
    
    function loadActivityData(sensorID)
    {
      $.ajax({
        url: 'http://api.sense-os.nl/sensors/' + sensorID + '/data.json?last=1',
        type: 'GET',
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-SESSION_ID', localStorage.getItem('senseSessionId'));
          return true;
        },
        contentType: 'application/json',
        xhrFields: {
          withCredentials: false
        },
        success: function(jsonData, status, xhr) {
          var json = JSON.parse(xhr.responseText);
          var data = json["data"];
          renderActivityData(data);
    			//console.log(data);   
        },
        error: function() {
        }
      }); 
    }
    
    function renderActivityData(data){
    	//console.log('Activity :', data); 
    	var activity = data;      	
    }
         
  
  </script>

  <script src="http://www.google.com/jsapi" type="text/javascript"></script>
  
  <script>google.load("visualization", "1");</script>
  
  <script src="js/webpaige.js" type="text/javascript"></script>
  
  <script src="js/timeline/timeline.js" type="text/javascript"></script>
  <link href="js/timeline/timeline.css" rel="stylesheet" type="text/css">
  <script src="js/timeline/timeline_init.js" type="text/javascript"></script>

</head>

<body onload='global_init(); homePage_init();'>
  <div class="navbar navbar-fixed-top navbar-inner container-fluid">
    <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"></a> <a class="brand" href="dashboard.html">WebPaige</a>

    <div class="btn-group pull-right">
      <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-user"></i> <span class="d_username">{Username}</span> <span class="caret"></span></a>
      <ul class="dropdown-menu">
        <li><a href="profile.html"><i class="icon-user"></i> Profile</a></li>
        <li><a href="settings.html"><i class="icon-cog"></i> Settings</a></li>
        <li><a href="help.html"><i class="icon-info-sign"></i> Help</a></li>
        <li class="divider"></li>
        <li><a href="logout.html"><i class="icon-off"></i> Sign Out</a></li>
      </ul>
    </div>

    <div class="nav-collapse">
      <ul class="nav">
        <li class="active"><a href="dashboard.html">Dashboard</a></li>
        <li><a href="messages.html">Messages</a></li>
        <li><a href="todos.html">Todos</a></li>
        <li><a href="groups.html">Groups</a></li>
        <li><a href="tasks.html">Tasks</a></li>
        <li><a href="appointments.html">Appointments</a></li>
        <li><a href="alarms.html">Alarms</a></li>
        <li><a href="orders.html">Orders</a></li>
        <li><a href="deliveries.html">Deliveries</a></li>
        <li><a href="states.html">States</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>

  <div class="container-fluid">       
  
		<div class="hero-unit">
		 <h1>Welcome, <span class="d_username">{Username}</span> !</h1>
		 <p>In order to help you better, I would like to connect with your social media. Do you want to fill in your social media preferences?</p>
		 <p><a class="btn btn-large">Remind me later</a> <a class="btn btn-large btn-success">Yes</a></p>
		</div>
  
    <div class="row-fluid">
      <div class="span12 well">
        <div class="btn-group btn-hanging">
          <a class="btn" data-toggle="modal" href="#newEvent"><i class="icon-plus-sign"></i> New event</a>
          <a class="btn" href="appointments.html"><i class="icon-calendar"></i> My appointments</a>
        </div>

        <div class="modal hide" id="newEvent">
          <div class="modal-header">
            <button class="close" data-dismiss="modal" type="button">×</button>

            <h3>New event</h3>
          </div>

          <form class="">
            <div class="modal-body">

              <div class="control-group">
                <label class="control-label">Title</label>
                <div class="controls">
                  <input class="span12" placeholder="" type="text">
                </div>
              </div>

              <div class="control-group">
                <label class="control-label">From</label>
                <div class="controls">
                  <input class="span4" placeholder="" type="text" style="display:inline;">
                  <select class="span4" style="display:inline;">
                    <option value=""></option>
                  </select>
                </div>
              </div>

              <div class="control-group">
                <label class="control-label">Till</label>
                <div class="controls">
                  <input class="span4" placeholder="" type="text" style="display:inline;">
                  <input class="span3" placeholder="" type="text" style="display:inline;">
                </div>
              </div>

              <div class="control-group" style="float:left; margin-right:30px;">
                <label class="control-label">Weekly occurring?</label>
                <div class="controls">
                  <input type="checkbox" name="re-occuring">
                </div>
              </div>

              <div class="control-group" style="float:left;">
                <label class="control-label">All day?</label>
                <div class="controls">
                  <input type="checkbox" name="all-day">
                </div>
              </div>
              
              <div class="clear"></div>
              
            </div>

            <div class="modal-footer">
              <a class="btn" data-dismiss="modal" href="#"><i class="icon-remove"></i> Cancel</a>
              <a class="btn btn-success" href="#"><i class="icon-ok icon-white"></i> Save event</a>
            </div>
          </form>
        </div>

        <h2><span class="entypo eMedium">P</span> Upcoming events</h2>

        <div id="mytimeline"></div>
      </div><!--/span-->
    </div>

    <div class="row-fluid">
	      
      <div class="span4 well">
      
        <div class="btn-group btn-hanging">
          <a class="btn" href="messages.html"><i class="icon-comment"></i> All messages</a>
        </div>

        <h2><span class="entypo eMedium">w</span> Messages</h2>
        <hr>

        <div id="messageBalloon" class="alert alert-info">
          <button class="close" data-dismiss="alert" type="button">×</button>
          You have a request to postpone your meeting with Kees to friday the 12th of april. Do you accept this request?
          <div id="balloonPointer"><img src="img/balloon_pointer.png" alt="pointer" /></div>
        </div>

        <div class="btn-group pull-left">
          <a class="btn" href=""><i class="icon-ok-sign"></i> Yes</a>
          <a class="btn" href="appointments.html"><i class="icon-info-sign"></i>  Go to appointment</a>
          <a class="btn" href=""><i class="icon-remove-sign"></i>  No</a>
        </div>

        <div class="btn-group pull-right">
          <a class="btn" href="#"><i class="icon-chevron-left"></i></a>
          <a class="btn" href="#"><i class="icon-chevron-right"></i></a>
        </div>
      </div><!--/span-->
    
      <div class="span4 well">
        <h2><span class="entypo eMedium">&quot;</span> Activity</h2>
        <hr>
        <p>Here comes some more information about the states.</p>
      </div><!--/span-->
  
      <div class="span4 well">
        <h2><span class="entypo eMedium">&#44;</span> Social</h2>
        <hr>
        <p>Here comes some more information about the states.</p>
      </div><!--/span-->
  
      <div class="span4 well">
        <h2><span class="entypo eMedium">N</span> Availability</h2>
        <hr>
        <p>Here comes some more information about the states.</p>
      </div><!--/span-->
  
      <div class="span4 well">
        <h2><span class="entypo eMedium">0</span> Location</h2>
        <p>You are last seen at <span id="locationDate">{Location date}</span>, <span id="location">{Location}</span></p>
        <iframe id="widgetLocation" src="http://localhost:8888/widget_location.html"></iframe>
      </div><!--/span-->
      
    </div>

    <footer>
      <p>Ask Community Systems 2012, WebPaige v1.0<br>
      <img alt="Ask Community Systems" src="img/company_logo.png"></p>
    </footer>
    
  </div><!--/.fluid-container-->
</body>
</html>